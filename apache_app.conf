# Configuração Apache para DigitalOcean Heroku Buildpack
# Forçar processamento PHP em todos os contextos

# Configurar tipos MIME primeiro
AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps

# Forçar processamento PHP globalmente
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
    ForceType application/x-httpd-php
</FilesMatch>

# Configurar diretório raiz (/app no buildpack Heroku)
<Directory /app>
    DirectoryIndex index.php index.html
    AllowOverride All
    Options -Indexes +FollowSymLinks
    Require all granted
    
    # Dupla garantia de processamento PHP
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
        ForceType application/x-httpd-php
    </FilesMatch>
</Directory>

# Configurar diretório API especificamente
<Directory /app/api>
    DirectoryIndex index.php
    AllowOverride All
    Options -Indexes +FollowSymLinks
    Require all granted
    
    # Tripla garantia para API
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
        ForceType application/x-httpd-php
        AddHandler application/x-httpd-php .php
    </FilesMatch>
</Directory>

# Headers CORS
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Habilitar mod_rewrite
RewriteEngine On